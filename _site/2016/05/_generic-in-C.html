<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      _Generic in C And Generic LinkedList Implementation &middot; Abhishek Nagekar's Blog
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Icons -->
  <link rel="shortcut icon" href="/assets/images/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">



<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
    

  <nav class="sidebar-nav">
    

    
    
      
        
          <a class="sidebar-nav-item" href="/">Sometimes, I write..</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="/archive">Archive</a>
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/meta">Meta</a>
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/search">Search This Blog</a>
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/tags">Tags</a>
        
      
    
    <a class="sidebar-nav-item" href="https://github.com/abhn">My GitHub</a>
    <a class="sidebar-nav-item" href="/search">Search This Blog</a>
    <a class="sidebar-nav-item" onclick="window.open('https://feedburner.google.com/fb/a/mailverify?uri=AbhishekN', 'popupwindow', 'scrollbars=yes,width=550,height=520');return true" target="popupwindow" href="https://feedburner.google.com/fb/a/mailverify?uri=AbhishekN">Email Subscription</a>
    
    
  </nav>

  <div class="sidebar-item">
    <p>
      Abhishek Nagekar &copy; 2016
    <br>
      <small>Some Rights Reserved</small>
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Abhishek Nagekar's Blog</a>
            <small>Code, Science, Philosophy, Humor</small>
          </h3>
        </div>
      </div>
      <div class="container content">
        <div id="head-quote"></div>
        <div class="post">
  <h1 class="post-title">_Generic in C And Generic LinkedList Implementation</h1>
  <span class="post-date">3 May, 2016. It was a Tuesday.</span>
  <p>
  Tada! Finally a non-Javascript post for those of you who stopped visiting my blog because of my sick Js addiction. So my lost friend Aditya is back, and while talking to him, I got to read a piece of code that he wrote when we were in third semester, last year. The aim was to build a generic container to store different datatypes, in C. So yes, literally storing [21, "abhishek", 3.142, 'z'] in a single dynamically allocated linkedlist. That was pretty bold for us then.
</p>
<p>
  For making that happen, he made use of the <a href="https://en.wikipedia.org/wiki/C11_(C_standard_revision)#Changes_from_C99_">_Generic</a> macro that C11 introducted for generic type selection. For those unfamiliar with it, I'll begin with explaining the basics of the macro. For those of you interested in the linkedlist code, scroll down to the bottom of this article. You can always check out the <a href="http://www.open-std.org/jtc1/sc22/wg14/www/docs/n1570.pdf">C11 draft [section 6.5.1.1 Generic selection pg #96]</a> (the standard costs around $60 but is essentially the same thing).
</p>
<p>
	 The _Generic macro follows the format <code>_Generic(controlling-expression, association-list)</code> where <i>controlling-expression</i> is the expression whose type is to be detected, and <i>association-list</i> is the dictionary of type-expression pairs where type can be any object type and the expression can be any expression, constant or a pointer to any function, pretty much anything that can be evaluated.
</p>
<p>
	To put it simply, compare it to the switch statement for type detection. For example,
</p>
<pre>
#include &lt;stdio.h&gt;
int main() {
  char *teststring = "my char array"; // target object
  char *type = _Generic(
    teststring,
    int: "int",
    int*: "int *",
    char: "char",
    char*: "char *",
    float: "float",
    default: "default"
  );
  printf("%s", type);
  return 0;
}

~$ gcc main.c
~$ ./a.out
char *
</pre>
<p>
	The _Generic macro can be wrapped around in a nice looking function call, say detect_type(). Compare this to a (pseudo) switch statement which evaluates the case that matches the switch params
</p>
<pre>
// Pseudocode may resemble Javascript. Reader discretion advised
var someobj = "text here"; // target object
var type; // to store the typename
type_switch(someobj) {
  case int:
    type = "int";
  case int*:
    type = "int*";
  case char:
    type = "char";
  case char*:
    type = "char*";
  default:
    type = "default";
}
print(type)
</pre>
<p>
	So that is it. A compile time type identification in C with a simple macro. We can do pretty amazing stuff with it using pointers to functions. For example, a generic print function, that can take in any type of argument and print it. I have added cases for integers, characters and string, but others can be added just as easily.
</p>
<script src="https://gist.github.com/abhn/3887df927f2d913c03704cac3ddaa9fc.js"></script>
<p>
	That was neat, wasn't it. Now back to Aditya. He used the same macro to create a dynamically allocated linkedlist. I am pasting the gist here so that you can read his beautiful code.
  <button id="btn">Show Code</button>
</p>
<p>
  <div id="vector">
    <h4>File <b>linkedlist.c</b></h4>
    <script src="https://gist.github.com/abhn/0699d92bb972320e33b3cee8f81abc23.js"></script>
    <h4>File <b>linkedlist.h</b></h4>
    <script src="https://gist.github.com/abhn/6175447dd928d4c46bdc7f51b90c8b33.js"></script>
    <h4>File <b>main.c</b></h4>
    <script src="https://gist.github.com/abhn/cacf3b03483759c02e997afe13aa3373.js"></script>
  </div>
</p>
<p>
	To compile it, run <pre>~$ gcc main.c linkedlist.c -o linkedlist</pre> on any machine with GCC installed (I've tested it on version &gt;4.9). Run it with <pre>~$ ./linkedlist</pre> and you should see the different elements that we've added printed on the standard out. You may also pack the linkedlist into a statically linked library, by running.
</p>
<pre>
~$ gcc -c linkedlist.c -o linkedlist.o
~$ ar rcs linkedlist.a linkedlist.o
~$ gcc main.c linkedlist.a
</pre>
<p>
  Interesting, isn't it? Want to thank him, or have any comments or improvements? Drop them into the comment box. Thank you for reading.
</p>
<p>
  <h4>External Links</h4>
  <ul>
    <li>
      <a href="https://www.ibm.com/support/knowledgecenter/SSGH2K_13.1.0/com.ibm.xlc131.aix.doc/language_ref/genericselection.html">IBM KB article on generic selector</a>
    </li>
    <li>
      <a href="http://www.robertgamble.net/2012/01/c11-generic-selections.html?m=1">Robert Gamble's blog post: c11 generic selections</a>
    </li>
    <li>
      <a href="http://stackoverflow.com/questions/9804371/syntax-and-sample-usage-of-generic-in-c11">Stackoverflow question: syntax and sample usage of generic in c11</a>
    </li>
  </ul>
</p>
<script>
  document.getElementById('vector').style.display = 'none';
  document.getElementById('btn').addEventListener('click', function showVec() {
    document.getElementById('vector').style.display = 'block';
  });
</script>

</div>

<div class="related">
  <h2>You May Also Like</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/2016/07/the-project-lumos-experience.html">
            The Project Lumos Experience
            <small>03 May 2016</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2016/06/sixth-semester-and-then.html">
            Sixth Semester And Then
            <small>03 May 2016</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2016/04/being-stupid.html">
            Being Stupid
            <small>03 May 2016</small>
          </a>
        </h3>
      </li>
    
  </ul>
  <hr>
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-2314128584981990"
         data-ad-slot="1513670662"
         data-ad-format="auto"></ins>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
  <hr>
  


  <div id="disqus_thread"></div>
<script type="text/javascript">
    
    var disqus_developer = 1;
    var disqus_shortname = 'nagekar'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>




</div>

      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-74790644-1', 'auto');
        ga('send', 'pageview');
    </script>
    <script>
        var txtFile = new XMLHttpRequest();
        txtFile.open("GET", "/quotes.txt", true);
        txtFile.onreadystatechange = () => {
          if (txtFile.readyState === 4) {  
            if (txtFile.status === 200) { 
              allText = txtFile.responseText; 
              lines = txtFile.responseText.split("\n");
              randLine = lines[Math.floor((Math.random() * lines.length) + 1)];
              document.getElementById('head-quote').innerHTML = '<p class="message" style="font-size: 14px; font-color: grey; text-align: center;">' + randLine + '<small></p>';
            }
          }
        }
        txtFile.send(null);
    </script>
  </body>
</html>
