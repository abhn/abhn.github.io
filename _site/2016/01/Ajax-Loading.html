
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>AJAX Loading - Part 1</title>
    <meta name="author" content="Abhishek Nagekar">
   
    
    <meta name="title" content="AJAX Loading - Part 1">
    

    
    <meta name="description" content="I always admired the sites which did not reload upon clicking links here and there, but simple gave me whatever I requested for, with grace. Sites like Facebook, Twitter and Youtube extensively use it, and the application hardly reloads after the initial reload. Here's my attempt on making something similar....">
    
    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Bootstrap styles -->
    <link href="/assets/themes//bootstrap/css/bootstrap_bundled.min.css" rel="stylesheet">

    <!-- Favicon -->
    <link rel="shortcut icon" href="http://www.nagekar.com/assets/images/favicon.ico" type="image/x-icon" />

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <!-- atom & rss feed -->
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

  </head>

  <body>

    <div id="wrap">

      <nav class="navbar navbar-default" role="navigation">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#jb-navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">Abhishek Nagekar's Blog</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="jb-navbar-collapse">
          <ul class="nav navbar-nav">
            
            
            


  
    
      
      	
      	<li><a href="/archive">Archive</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/meta">Meta</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/tags">Tags</a></li>
      	
      
    
  



	   <form class="navbar-form navbar-right" action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open('https://feedburner.google.com/fb/a/mailverify?uri=AbhishekN', 'popupwindow', 'scrollbars=yes,width=550,height=520');return true">
    <div class="form-group">
    <input type="email" value="" name="email" class="form-control" placeholder="email address" required>
    <input type="hidden" value="AbhishekN" name="uri"><input type="hidden" name="loc" value="en_US">
    </div>
    <input type="submit" value="Subscribe" name="subscribe" class="btn btn-default" class="button">
</form>
          </ul>
        </div><!-- /.navbar-collapse -->
      </nav>

      <div class="container">
        
<div class="page-header">
  <h1>AJAX Loading - Part 1 </h1>
</div>

<div class="row post-full">
  <div class="col-xs-12">
    <div class="date">
      <span>31 January, 2016. It was a Sunday.</span>
    </div>
    <div class="content">
      <p>
	I always admired the sites which did not reload upon clicking links here and there, but simple gave me whatever I requested for, with grace. Sites like Facebook, Twitter and Youtube extensively use it, and the application hardly reloads after the initial reload. Here's my attempt on making something similar.
</p>
<p>
	Firstly, I downloaded a free HTML template from <a href="http://www.onlinecasinos.im/" target="_blank">Online Casinos</a>. The links had to be edited. The pattern I used was to replace, for example, any (internal) link pointing to <code>example.html</code> to <code>#/example.html</code>. What it did was 1.) prevent the page from reloading, and 2.) putting the requested location to some place from where I can extract it with Javascript.
</p>
<p>
	Next, grab that location of the hash. The Javascript's built in method <code>window.location.hash</code> provides the page's current hash. We drop the first char from the returned hash as it is the hash (#) character itself. The hash value is essentially the location to be navigated to, hence, we use some string manipulation to craft a new URL from it, and make an AJAX request to fetch the contents of the page requested, and insert it into the div specified through Javascript.
</p>
<p>
	For example, suppose we are on about.html page. Now if I click 'contact' link, the link would change to /about.html#/contact.html, the hash value would be grabbed by the window.location.hash method, a GET request is fired to get that location with a XMLHttpRequest object, the response is inserted with innerHTML method on the div, and using the <code>window.history.pushState()</code> method, we update the URL to /contact.html, to ease sharing. All this, in the blink of an eye. Cool.
</p>
<p>
	I could do it in two different ways. One was to just place the text in those files and inserting them into the template. The drawback of this was that if a user directly visits that page, he/she would just see plain text. For example, <a href="/assets/ajaxreload/index.html">check this link out</a>. The Javascript code for that was,
</p>
<pre>
var elements = document.getElementsByTagName('a'); // grab all hyperlinks

for(var i = 0, len = elements.length; i < len; i++) { // for every hyperlink
    elements[i].onclick = function () {
        var xmlObj = new XMLHttpRequest();
        xmlObj.addEventListener('load', function() {
            var res = this.responseText;
            var main = document.getElementById('main');
            main.innerHTML = res;
        });

        getHash(function(hash) {
            var url = 'template2' + hash; // hack for Webstorm IDE, sorry I don't regex
            url = 'http://' + window.location.host + '/' + url;
            console.log(url);
            xmlObj.open('GET', url);
            xmlObj.send();
            window.history.pushState('', '', url); // update the address bar for ease of url sharing (optional)
        });

    }
}

function getHash(callback) {
    window.onhashchange = function() {
        if(window.location.hash == '') { // in case the page clicked is index
            window.location = 'http://' + window.location.host + '/template2';
        }
        callback(window.location.hash.substr(1)); // get the hash and drop the first character
    }
}
</pre>
<p>
	The separate callback function for getHash was necessary because onclick() event fires before the hash is changed, and it would result in the script grabbing the previous hash. As already mentioned, the navigation is smooth if one visits index.html and then other links, but try getting the about.html page first. All you'll see are a few lines of text.
</p>
<p>
	A sloppy solution to the above problem was to replicate the entire index page with varying content for each of the page, and then replace entire DOM on anchor click. You can imagine this is not at all smart, and would destroy the point of this site. Not to mention the extra bandwidth to reload the same resources on every request. <a href="/assets/ajaxreload2/index.html">Here is the implementation</a> for this method.
</p>
<p>
	What would be the smarter way? Perhaps, making sure the first page to load always downloads the entire html every time, and subsequent requests to be made to download the changed content. I will be implementing this solution shortly. Drop in your ideas too, and share if you enjoyed reading this. 
</p>
    </div>

    

  
    <ul class="tag_box inline">
      <li><i class="glyphicon glyphicon-tags"></i></li>
      
      


  
     
    	<li><a href="/tags.html#javascript-ref">javascript <span>4</span></a></li>
    
  



    </ul>
  
    <hr>
    <div class="panel panel-default">
      <div class="panel-heading">Know someone who might be interested in this story? Share!</div>
      <div class="panel-body"><a href="https://www.facebook.com/sharer/sharer.php?u=http://www.nagekar.com/2016/01/Ajax-Loading.html" target="_blank">Facebook</a> | <a href="https://twitter.com/share?url=http://www.nagekar.com/2016/01/Ajax-Loading.html&text=AJAX Loading - Part 1&via=abhisheknagekar" target="_blank">Twitter</a> | <a href="https://plus.google.com/share?url=http://www.nagekar.com/2016/01/Ajax-Loading.html" target="_blank">Google Plus</a> | <a href="http://www.linkedin.com/shareArticle?url=http://www.nagekar.com/2016/01/Ajax-Loading.html&title=AJAX Loading - Part 1" target="_blank">Linkedin</a> | <a href="http://reddit.com/submit?url=http://www.nagekar.com/2016/01/Ajax-Loading.html&title=AJAX Loading - Part 1" target="_blank">Reddit</a></div>
    </div>
    <hr>    
    <ul class="pagination">
    
      <li class="prev"><a href="/2016/01/exchanging-chikoos-for-friends.html" title="Exchanging Chikoos For Friends">&laquo; Previous</a></li>
    
      <li><a href="">Archive</a></li>
    
      <li class="next disabled"><a>Next &rarr;</a>
    
    </ul>
    <hr>
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-2314128584981990"
         data-ad-slot="1513670662"
         data-ad-format="auto"></ins>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
    <hr>
    


  <div id="disqus_thread"></div>
<script type="text/javascript">
    
    var disqus_developer = 1;
    var disqus_shortname = 'nagekar'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




  </div>
</div>


      </div>

    </div>

    <div id="footer">
      <div class="container">
        <p>&copy; 2016 Abhishek Nagekar
          | <a href="http://jekyllbootstrap.com" target="_blank">Jekyll</a>
          | <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>
        </p>
      </div>
    </div>

    





    <!-- Latest compiled and minified JavaScript, requires jQuery 1.x (2.x not supported in IE8) -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="/assets/themes//bootstrap/js/jquery-1.10.2.min.js"></script>
    <script src="/assets/themes//bootstrap/js/bootstrap.min.js"></script>
  </body>
</html>

