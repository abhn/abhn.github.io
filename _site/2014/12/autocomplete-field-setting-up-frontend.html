<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Creating an autocomplete field | Setting up frontend | Part 2 &middot; Abhishek Nagekar's Blog
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Icons -->
  <link rel="shortcut icon" href="/assets/images/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">



<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">

    <div class="sidebar-item">
        <img src="/assets/images/me.jpg" />
        <p>One of them is me.</p>
    </div>


  <nav class="sidebar-nav">
    

    
    
      
        
          <a class="sidebar-nav-item" href="/">Sometimes, I write..</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="/archive">Archive</a>
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/meta">Meta</a>
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/search">Search This Blog</a>
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/tags">Tags</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="/wish">Wish List</a>
        
      
    
    <a class="sidebar-nav-item" href="https://github.com/abhn">My GitHub</a>
    <a class="sidebar-nav-item" href="/search">Search This Blog</a>
    <a class="sidebar-nav-item" onclick="window.open('https://feedburner.google.com/fb/a/mailverify?uri=AbhishekN', 'popupwindow', 'scrollbars=yes,width=550,height=520');return true" target="popupwindow" href="https://feedburner.google.com/fb/a/mailverify?uri=AbhishekN">Email Subscription</a>
    
    
  </nav>

  <div class="sidebar-item">
    <p>
      Abhishek Nagekar &copy; 2016
    <br>
      <small>Some Rights Reserved</small>
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Abhishek Nagekar's Blog</a>
            <small>Code, Science, Philosophy, Humor</small>
          </h3>
        </div>
      </div>
      <div class="container content">
        <div id="head-quote"></div>
        <div class="post">
  <h1 class="post-title">Creating an autocomplete field | Setting up frontend | Part 2</h1>
  <span class="post-date">20 December, 2014. It was a Saturday.</span>
  <div dir="ltr" style="text-align: left;" trbidi="on"><div dir="ltr" style="text-align: left;" trbidi="on"><div dir="ltr" style="text-align: left;" trbidi="on"><div dir="ltr" style="text-align: left;" trbidi="on">In the <a href="http://www.nagekar.com/2014/12/creating-autocomplete-field-with-ajax.html">first part of this article</a>, we had set up the backend MySQL database. Now we can write the code necessary to get information from the server and convert it to a format we can parse, JSON in my case here. So lets begin.<br /><br /><h4 style="text-align: left;">Step 4 - Writing script to get data from MySQL database</h4><div style="text-align: left;">As always, we can write it in any language we are comfortable with. PHP happens to be mine. The script is straight forward, accept the pincode via a GET request, 'pincode' parameter. Query the database for its existence, add it to an array and using <a href="http://php.net/manual/en/function.json-encode.php" target="_blank">json_encode()</a> function in PHP, display the output. If value does not exist, it will return null, and it is not our concern here about what happens after that, as it will be taken care by the application using this API.</div><div style="text-align: left;"><br /></div><div style="text-align: left;"><i>Code: retrieve.php</i></div></div><pre class="brush: php">&lt;?php<br /> $pincode = $_GET['pincode'];<br /> $conn = mysql_connect("localhost", "root", "password");<br /> mysql_select_db("turnouts") or die();<br /> <br /> $pincode = (string)mysql_real_escape_string($pincode);<br /> <br /> $sql = "SELECT taluka, district, state FROM pincode WHERE pincode = '$pincode'";<br /> $data = mysql_query($sql);<br /> if(!$data) {<br />  die(mysql_error());<br /> }<br /> $row = mysql_fetch_row($data);<br /> $taluka = $row[0];<br /> $district = $row[1];<br /> $state = $row[2];<br /> $state = str_replace("\r\n", "", $state);<br /> $taluka = strtolower($taluka);<br /> $district = strtolower($district);<br /> $state = strtolower($state);<br /> header('Content-type: application/json');<br /> $array = array('taluka'=&gt;$taluka, 'district'=&gt;$district, 'state'=&gt;$state);<br /> echo json_encode($array);<br />?&gt;&nbsp; </pre></div><br />The URL will follow the pattern, /retrieve.php?pincode=000000 and return data. As an example, the following image,<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-9FzaGvkA4nk/VJU8QZCIc0I/AAAAAAAAHvM/uiSEJCWN2gA/s1600/json.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-9FzaGvkA4nk/VJU8QZCIc0I/AAAAAAAAHvM/uiSEJCWN2gA/s1600/json.png" height="172" width="400" /></a></div><br />If you have come successfully to this step, then bingo! We now have a working API.<br /><br /><h4 style="text-align: left;">Step 5 - Writing an AJAX form using jQuery</h4><div style="text-align: left;">&nbsp;We will now write a simple form with 4 fields in HTML. Include jQuery in that page, and then write the script at the bottom which will query our API asynchronously.</div><div style="text-align: left;"><br /></div><div style="text-align: left;">Code: pincodes.html</div></div><pre class="brush: jscript">&lt;html&gt;<br />&lt;head&gt;<br /> &lt;title&gt;Pincodes&lt;/title&gt;<br /> &lt;script src="js/jquery-1.10.2.min.js"&gt;&lt;/script&gt;<br />&lt;/head&gt;<br />&lt;body&gt;<br />&lt;div id="form"&gt;<br /> &lt;label for="pincode"&gt;Pincode:&lt;/label&gt;<br /> &lt;input type="text" name="pincode" id="pincode" required /&gt;&lt;br /&gt;<br /><br /> &lt;label for="taluka"&gt;Taluka:&lt;/label&gt;<br /> &lt;input type="text" name="taluka" id="taluka" /&gt;&lt;br /&gt;<br /> &lt;label for="district"&gt;District: &lt;/label&gt;<br /> &lt;input type="text" name="district" id="district"&gt;&lt;br /&gt;<br /> &lt;label for="state"&gt;State:&lt;/label&gt;<br /> &lt;input type="text" name="state" id="state"&gt;&lt;br /&gt;<br />&lt;/div&gt;<br />&lt;script&gt;<br />$(document).ready(function() {<br /> $('#pincode').keyup(function(e) {<br />  var pincode = $(this).val();<br />  <br />  if(pincode.length == 6 &amp;&amp; $.isNumeric(pincode)) {<br />   var req = 'retrive.php?pincode=' + pincode;<br />   $.getJSON(req, null, function(data) {</pre><pre class="brush: jscript">                 <br />    $('#taluka').val(data.taluka);<br />    $('#district').val(data.district);<br />    $('#state').val(data.state);<br />   });<br />  };<br /> });<br />});<br />&lt;/script&gt;<br />&lt;/body&gt;<br />&lt;/html&gt;<br /></pre><br />Some explanation goes here.<br />The <i>.keyup()</i> event fires when a key is pressed in that field. We could have use <i>onFocus()</i> or <i>onBlur()</i> in javascript but that only fires when a field is focused or blurred, so this is much better. Since we have pincodes of length 6 digits here in India, to prevent script from querying for the first five digits, we have added a <i>if(pincode.length == 6) </i>to our code.<br /><br />As I said, the even fires as soon as one enters the 6th digit and populates the remaining three fields with the data it retrieves. <br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-CwczhZADQbA/VJVAJLLBbwI/AAAAAAAAHvY/9ZHX-eim0_Y/s1600/form.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://2.bp.blogspot.com/-CwczhZADQbA/VJVAJLLBbwI/AAAAAAAAHvY/9ZHX-eim0_Y/s1600/form.png" height="212" width="400" /></a></div>It is hard to show it in a still image, but having just entered the pin, rest of the fields get populated.<br /><br /><h4 style="text-align: left;">Finally</h4><div style="text-align: left;">So this was it. I hope you enjoyed it. Any corrections or suggesting, mail them to me or just comment down below. Thank you for reading.</div></div>
</div>

<div class="related">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-2314128584981990"
         data-ad-slot="1513670662"
         data-ad-format="auto"></ins>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
  <hr>
  


  <div id="disqus_thread"></div>
<script type="text/javascript">
    
    var disqus_developer = 1;
    var disqus_shortname = 'nagekar'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>




</div>

      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-74790644-1', 'auto');
        ga('send', 'pageview');
    </script>
    <script>
        // stop reading other people's source, dude. That is rude
        var txtFile = new XMLHttpRequest();
        txtFile.open("GET", "/quotes.txt", true);
        txtFile.onreadystatechange = () => {
          if (txtFile.readyState === 4) {  
            if (txtFile.status === 200) { 
              allText = txtFile.responseText; 
              lines = txtFile.responseText.split("\n");
              randLine = lines[Math.floor((Math.random() * lines.length) + 1)];
              document.getElementById('head-quote').innerHTML = '<p class="message" style="font-size: 14px; font-color: grey; text-align: center;">' + randLine + '<small></p>';
            }
          }
        }
        txtFile.send(null);
    </script>
  </body>
</html>
