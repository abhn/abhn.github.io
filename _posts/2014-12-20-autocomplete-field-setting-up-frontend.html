---
layout: post
title: Creating an autocomplete field | Setting up frontend | Part 2
tags:
- javascript
- mysql
- jquery
- json
- php
- html
---

<div dir="ltr" style="text-align: left;" trbidi="on"><div dir="ltr" style="text-align: left;" trbidi="on"><div dir="ltr" style="text-align: left;" trbidi="on"><div dir="ltr" style="text-align: left;" trbidi="on">In the <a href="http://www.nagekar.com/2014/12/creating-autocomplete-field-with-ajax.html">first part of this article</a>, we had set up the backend MySQL database. Now we can write the code necessary to get information from the server and convert it to a format we can parse, JSON in my case here. So lets begin.<br /><br /><h4 style="text-align: left;">Step 4 - Writing script to get data from MySQL database</h4><div style="text-align: left;">As always, we can write it in any language we are comfortable with. PHP happens to be mine. The script is straight forward, accept the pincode via a GET request, 'pincode' parameter. Query the database for its existence, add it to an array and using <a href="http://php.net/manual/en/function.json-encode.php" target="_blank">json_encode()</a> function in PHP, display the output. If value does not exist, it will return null, and it is not our concern here about what happens after that, as it will be taken care by the application using this API.</div><div style="text-align: left;"><br /></div><div style="text-align: left;"><i>Code: retrieve.php</i></div></div><pre class="brush: php">&lt;?php<br /> $pincode = $_GET['pincode'];<br /> $conn = mysql_connect("localhost", "root", "password");<br /> mysql_select_db("turnouts") or die();<br /> <br /> $pincode = (string)mysql_real_escape_string($pincode);<br /> <br /> $sql = "SELECT taluka, district, state FROM pincode WHERE pincode = '$pincode'";<br /> $data = mysql_query($sql);<br /> if(!$data) {<br />  die(mysql_error());<br /> }<br /> $row = mysql_fetch_row($data);<br /> $taluka = $row[0];<br /> $district = $row[1];<br /> $state = $row[2];<br /> $state = str_replace("\r\n", "", $state);<br /> $taluka = strtolower($taluka);<br /> $district = strtolower($district);<br /> $state = strtolower($state);<br /> header('Content-type: application/json');<br /> $array = array('taluka'=&gt;$taluka, 'district'=&gt;$district, 'state'=&gt;$state);<br /> echo json_encode($array);<br />?&gt;&nbsp; </pre></div><br />The URL will follow the pattern, /retrieve.php?pincode=000000 and return data. As an example, the following image,<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-9FzaGvkA4nk/VJU8QZCIc0I/AAAAAAAAHvM/uiSEJCWN2gA/s1600/json.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-9FzaGvkA4nk/VJU8QZCIc0I/AAAAAAAAHvM/uiSEJCWN2gA/s1600/json.png" height="172" width="400" /></a></div><br />If you have come successfully to this step, then bingo! We now have a working API.<br /><br /><h4 style="text-align: left;">Step 5 - Writing an AJAX form using jQuery</h4><div style="text-align: left;">&nbsp;We will now write a simple form with 4 fields in HTML. Include jQuery in that page, and then write the script at the bottom which will query our API asynchronously.</div><div style="text-align: left;"><br /></div><div style="text-align: left;">Code: pincodes.html</div></div><pre class="brush: jscript">&lt;html&gt;<br />&lt;head&gt;<br /> &lt;title&gt;Pincodes&lt;/title&gt;<br /> &lt;script src="js/jquery-1.10.2.min.js"&gt;&lt;/script&gt;<br />&lt;/head&gt;<br />&lt;body&gt;<br />&lt;div id="form"&gt;<br /> &lt;label for="pincode"&gt;Pincode:&lt;/label&gt;<br /> &lt;input type="text" name="pincode" id="pincode" required /&gt;&lt;br /&gt;<br /><br /> &lt;label for="taluka"&gt;Taluka:&lt;/label&gt;<br /> &lt;input type="text" name="taluka" id="taluka" /&gt;&lt;br /&gt;<br /> &lt;label for="district"&gt;District: &lt;/label&gt;<br /> &lt;input type="text" name="district" id="district"&gt;&lt;br /&gt;<br /> &lt;label for="state"&gt;State:&lt;/label&gt;<br /> &lt;input type="text" name="state" id="state"&gt;&lt;br /&gt;<br />&lt;/div&gt;<br />&lt;script&gt;<br />$(document).ready(function() {<br /> $('#pincode').keyup(function(e) {<br />  var pincode = $(this).val();<br />  <br />  if(pincode.length == 6 &amp;&amp; $.isNumeric(pincode)) {<br />   var req = 'retrive.php?pincode=' + pincode;<br />   $.getJSON(req, null, function(data) {</pre><pre class="brush: jscript">                 <br />    $('#taluka').val(data.taluka);<br />    $('#district').val(data.district);<br />    $('#state').val(data.state);<br />   });<br />  };<br /> });<br />});<br />&lt;/script&gt;<br />&lt;/body&gt;<br />&lt;/html&gt;<br /></pre><br />Some explanation goes here.<br />The <i>.keyup()</i> event fires when a key is pressed in that field. We could have use <i>onFocus()</i> or <i>onBlur()</i> in javascript but that only fires when a field is focused or blurred, so this is much better. Since we have pincodes of length 6 digits here in India, to prevent script from querying for the first five digits, we have added a <i>if(pincode.length == 6) </i>to our code.<br /><br />As I said, the even fires as soon as one enters the 6th digit and populates the remaining three fields with the data it retrieves. <br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-CwczhZADQbA/VJVAJLLBbwI/AAAAAAAAHvY/9ZHX-eim0_Y/s1600/form.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://2.bp.blogspot.com/-CwczhZADQbA/VJVAJLLBbwI/AAAAAAAAHvY/9ZHX-eim0_Y/s1600/form.png" height="212" width="400" /></a></div>It is hard to show it in a still image, but having just entered the pin, rest of the fields get populated.<br /><br /><h4 style="text-align: left;">Finally</h4><div style="text-align: left;">So this was it. I hope you enjoyed it. Any corrections or suggesting, mail them to me or just comment down below. Thank you for reading.</div></div>
